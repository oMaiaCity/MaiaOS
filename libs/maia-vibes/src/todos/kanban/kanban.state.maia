{
  "$schema": "@schema/state",
  "$id": "@state/kanban",
  "initial": "idle",
  "states": {
    "idle": {
      "on": {
        "DRAG_START": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/start",
              "payload": { "id": "$$id" },
              "onSuccess": {
                "updateContext": {
                  "draggedItemId": "$$result.draggedItemId",
                  "draggedItemIds": "$$result.draggedItemIds"
                }
              }
            }
          ]
        },
        "DRAG_END": {
          "target": "dragEnding"
        },
        "DRAG_OVER": "idle",
        "DROP": {
          "target": "dropping"
        },
        "TOGGLE_BUTTON": {
          "target": "idle",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "TOGGLE_BUTTON",
                "payload": { "id": "$$id", "done": "$$done" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "DELETE_BUTTON": {
          "target": "idle",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "DELETE_BUTTON",
                "payload": { "id": "$$id" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "TODO_CREATED": {
          "target": "idle"
        },
        "TODO_COMPLETED": {
          "target": "idle"
        },
        "TODO_DELETED": {
          "target": "idle"
        }
      }
    },
    "dragging": {
      "on": {
        "SUCCESS": {
          "target": "dragging",
          "actions": [
            {
              "updateContext": {
                "draggedItemId": "$$result.draggedItemId",
                "draggedItemIds": "$$result.draggedItemIds"
              }
            }
          ]
        },
        "DRAG_START": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/start",
              "payload": { "id": "$$id" },
              "onSuccess": {
                "updateContext": {
                  "draggedItemId": "$$result.draggedItemId",
                  "draggedItemIds": "$$result.draggedItemIds"
                }
              }
            }
          ]
        },
        "DRAG_END": {
          "target": "dragEnding"
        },
        "DRAG_ENTER": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/dragOver",
              "payload": { "column": "$$column" },
              "onSuccess": {
                "updateContext": {
                  "dragOverColumn": "$$result.dragOverColumn"
                }
              }
            }
          ]
        },
        "DRAG_LEAVE": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/dragOver",
              "payload": { "column": null },
              "onSuccess": {
                "updateContext": {
                  "dragOverColumn": "$$result.dragOverColumn"
                }
              }
            }
          ]
        },
        "DROP": "dropping",
        "TOGGLE_BUTTON": {
          "target": "dragEnding",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "TOGGLE_BUTTON",
                "payload": { "id": "$$id", "done": "$$done" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "DELETE_BUTTON": {
          "target": "dragEnding",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "DELETE_BUTTON",
                "payload": { "id": "$$id" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "ERROR": "error"
      }
    },
    "dragEnding": {
      "entry": {
        "tool": "@dragdrop/end"
      },
      "on": {
        "SUCCESS": {
          "target": "idle",
          "actions": [
            {
              "updateContext": {
                "draggedItemId": "$$result.draggedItemId",
                "dragOverColumn": "$$result.dragOverColumn",
                "draggedItemIds": "$$result.draggedItemIds"
              }
            }
          ]
        },
        "ERROR": "error",
        "DRAG_START": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/start",
              "payload": { "id": "$$id" },
              "onSuccess": {
                "updateContext": {
                  "draggedItemId": "$$result.draggedItemId",
                  "draggedItemIds": "$$result.draggedItemIds"
                }
              }
            }
          ]
        },
        "DRAG_ENTER": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/dragOver",
              "payload": { "column": "$$column" },
              "onSuccess": {
                "updateContext": {
                  "dragOverColumn": "$$result.dragOverColumn"
                }
              }
            }
          ]
        },
        "DRAG_LEAVE": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/dragOver",
              "payload": { "column": null },
              "onSuccess": {
                "updateContext": {
                  "dragOverColumn": "$$result.dragOverColumn"
                }
              }
            }
          ]
        },
        "DROP": "dropping",
        "DRAG_END": "dragEnding",
        "TOGGLE_BUTTON": {
          "target": "idle",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "TOGGLE_BUTTON",
                "payload": { "id": "$$id", "done": "$$done" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "DELETE_BUTTON": {
          "target": "idle",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "DELETE_BUTTON",
                "payload": { "id": "$$id" },
                "target": "@actor/agent"
              }
            }
          ]
        }
      }
    },
    "dropping": {
      "entry": {
        "tool": "@dragdrop/drop",
        "payload": { 
          "field": "$$field",
          "value": "$$value"
        }
      },
      "on": {
        "SUCCESS": {
          "target": "dragEnding"
        },
        "DRAG_START": {
          "target": "dragging",
          "actions": [
            {
              "tool": "@dragdrop/start",
              "payload": { "id": "$$id" },
              "onSuccess": {
                "updateContext": {
                  "draggedItemId": "$$result.draggedItemId",
                  "draggedItemIds": "$$result.draggedItemIds"
                }
              }
            }
          ]
        },
        "DRAG_END": {
          "target": "dragEnding"
        },
        "TOGGLE_BUTTON": {
          "target": "dragEnding",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "TOGGLE_BUTTON",
                "payload": { "id": "$$id", "done": "$$done" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "DELETE_BUTTON": {
          "target": "dragEnding",
          "actions": [
            {
              "tool": "@core/publishMessage",
              "payload": {
                "type": "DELETE_BUTTON",
                "payload": { "id": "$$id" },
                "target": "@actor/agent"
              }
            }
          ]
        },
        "ERROR": "error"
      }
    },
    "error": {
      "entry": {
        "updateContext": { "error": "$$error" }
      },
      "on": {
        "RETRY": {
          "target": "idle",
          "actions": [
            {
              "updateContext": { "error": null }
            }
          ]
        },
        "DISMISS": {
          "target": "idle",
          "actions": [
            {
              "updateContext": { "error": null }
            }
          ]
        }
      }
    }
  }
}

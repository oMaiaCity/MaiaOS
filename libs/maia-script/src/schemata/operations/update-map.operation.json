{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://maia.city/operations/update-map",
  "title": "Update CoMap Operation Schema",
  "description": "Validates CoMap update operations with nested operations",
  "type": "object",
  "properties": {
    "op": {
      "const": "update",
      "description": "Operation type identifier"
    },
    "target": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^co_z[a-zA-Z0-9]+$",
          "description": "CoValue ID to update"
        }
      },
      "required": ["id"]
    },
    "changes": {
      "type": "object",
      "description": "Changes to apply to the CoMap",
      "additionalProperties": {
        "oneOf": [
          { "type": ["string", "number", "boolean", "null"] },
          {
            "type": "object",
            "properties": {
              "op": {
                "enum": ["increment", "decrement", "set", "delete"],
                "description": "Nested operation type"
              },
              "by": {
                "type": "number",
                "description": "Amount for increment/decrement"
              },
              "value": {
                "description": "Value for set operation"
              }
            },
            "required": ["op"]
          }
        ]
      }
    }
  },
  "required": ["op", "target", "changes"],
  "additionalProperties": false
}

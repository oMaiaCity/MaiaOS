{
  "$schema": "@schema/meta-schema",
  "$id": "https://maiaos.dev/schemas/view.schema.json",
  "title": "View Definition",
  "description": "UI structure definition with DOM tree, expressions, loops, and event handlers",
  "type": "object",
  "required": ["$type"],
  "properties": {
    "$type": {
      "type": "string",
      "const": "view"
    },
    "$id": {
      "type": "string",
      "description": "Unique view identifier",
      "pattern": "^co_view_"
    },
    "root": {
      "description": "Root DOM node (for leaf views)",
      "type": "object",
      "properties": {
        "tag": {
          "type": "string",
          "description": "HTML tag name"
        },
        "class": {
          "type": "string",
          "description": "CSS class name"
        },
        "text": {
          "description": "Text content (can be expression)",
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        },
        "value": {
          "description": "Input value (can be expression)",
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        },
        "attrs": {
          "type": "object",
          "description": "HTML attributes",
          "additionalProperties": {
            "anyOf": [
              {
                "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
              },
              {
                "type": "object",
                "description": "Nested attribute object (e.g., data attribute)",
                "additionalProperties": {
                  "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
                }
              }
            ]
          }
        },
        "children": {
          "type": "array",
          "description": "Child nodes",
          "items": {
            "$ref": "#/$defs/viewNode"
          }
        },
        "$on": {
          "type": "object",
          "description": "Event handlers",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "send": {
                "type": "string",
                "description": "Event name to send"
              },
              "payload": {
                "type": "object",
                "description": "Event payload",
                "additionalProperties": true
              },
              "key": {
                "type": "string",
                "description": "Keyboard key filter (e.g., 'Enter')"
              }
            },
            "required": ["send"]
          }
        },
        "$each": {
          "type": "object",
          "description": "Loop definition",
          "properties": {
            "items": {
              "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
            },
            "template": {
              "$ref": "#/$defs/viewNode"
            }
          },
          "required": ["items", "template"]
        },
        "$slot": {
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        }
      },
      "additionalProperties": false
    },
    "container": {
      "description": "Container node (for composite views)",
      "$ref": "#/$defs/viewNode"
    }
  },
  "$defs": {
    "viewNode": {
      "type": "object",
      "properties": {
        "tag": {
          "type": "string"
        },
        "class": {
          "type": "string"
        },
        "text": {
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        },
        "value": {
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        },
        "attrs": {
          "type": "object",
          "additionalProperties": {
            "anyOf": [
              {
                "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
              },
              {
                "type": "object",
                "description": "Nested attribute object (e.g., data attribute)",
                "additionalProperties": {
                  "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
                }
              }
            ]
          }
        },
        "children": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/viewNode"
          }
        },
        "$on": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "send": {
                "type": "string"
              },
              "payload": {
                "type": "object",
                "additionalProperties": true
              },
              "key": {
                "type": "string"
              }
            },
            "required": ["send"]
          }
        },
        "$each": {
          "type": "object",
          "properties": {
            "items": {
              "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
            },
            "template": {
              "$ref": "#/$defs/viewNode"
            }
          },
          "required": ["items", "template"]
        },
        "$slot": {
          "$ref": "https://maiaos.dev/schemas/common.schema.json#/$defs/expression"
        }
      },
      "additionalProperties": false
    }
  }
}

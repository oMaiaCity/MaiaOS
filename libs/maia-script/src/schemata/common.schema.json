{
  "$schema": "@schema/meta-schema",
  "$id": "https://maiaos.dev/schemas/common.schema.json",
  "title": "Common MaiaOS Definitions",
  "description": "Shared schema definitions used across multiple MaiaOS types",
  "$defs": {
    "expression": {
      "description": "MaiaScript expression (context reference, item reference, or literal)",
      "anyOf": [
        {
          "type": "string",
          "pattern": "^\\$\\$"
        },
        {
          "type": "string",
          "pattern": "^@"
        },
        {
          "type": "string",
          "pattern": "^\\$[^$]"
        },
        {
          "type": "string"
        },
        {
          "type": "number"
        },
        {
          "type": "boolean"
        },
        {
          "type": "null"
        }
      ]
    },
    "guard": {
      "description": "Guard condition for state machine transitions",
      "type": "object",
      "additionalProperties": true
    },
    "action": {
      "description": "Action (tool invocation or context update)",
      "type": "object",
      "properties": {
        "tool": {
          "type": "string",
          "description": "Tool identifier (e.g., '@mutation/create')"
        },
        "payload": {
          "description": "Tool payload (can contain expressions)",
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["tool"]
    },
    "transition": {
      "description": "State machine transition",
      "type": "object",
      "properties": {
        "target": {
          "type": "string",
          "description": "Target state name"
        },
        "guard": {
          "$ref": "#/$defs/guard"
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/action"
          }
        }
      },
      "required": ["target"]
    },
    "messagePayload": {
      "description": "Message payload definition",
      "type": "object",
      "additionalProperties": true
    }
  }
}

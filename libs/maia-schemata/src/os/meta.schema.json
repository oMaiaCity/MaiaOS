{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "@maia/schema/meta",
	"$vocabulary": {
		"https://json-schema.org/draft/2020-12/vocab/core": true,
		"https://json-schema.org/draft/2020-12/vocab/applicator": true,
		"https://json-schema.org/draft/2020-12/vocab/unevaluated": true,
		"https://json-schema.org/draft/2020-12/vocab/validation": true,
		"https://json-schema.org/draft/2020-12/vocab/meta-data": true,
		"https://json-schema.org/draft/2020-12/vocab/format-annotation": true,
		"https://json-schema.org/draft/2020-12/vocab/content": true,
		"https://maiaos.dev/vocab/cojson": true
	},
	"allOf": [{ "$ref": "https://json-schema.org/draft/2020-12/schema" }],
	"title": "@maia/schema/meta",
	"type": ["object", "boolean"],
	"indexing": false,
	"properties": {
		"title": {
			"type": "string",
			"description": "Human-readable schema title (required)"
		},
		"cotype": {
			"enum": ["comap", "colist", "costream"],
			"description": "CRDT type at schema root. Schemas can be comap (with properties), colist (with items), or costream (with items). CoText is modeled as colist with string items."
		},
		"$co": {
			"type": "string",
			"anyOf": [
				{
					"pattern": "^co_z[a-zA-Z0-9]+$",
					"description": "Co-id reference (after transformation)"
				},
				{
					"pattern": "^@[a-zA-Z0-9_-]+/schema/",
					"description": "Human-readable schema ID (before transformation)"
				}
			],
			"description": "Reference to schema that this property value must conform to (human-readable ID or co-id). Use $co in properties to reference separate CoValues, never use cotype in properties."
		},
		"indexing": {
			"type": "boolean",
			"default": false,
			"description": "Whether instances of this schema should be indexed in account.os.{schemaCoId}"
		}
	},
	"required": ["title", "cotype"],
	"$defs": {
		"comap": {
			"description": "CoMap - CRDT-based collaborative map/object",
			"type": "object",
			"properties": {},
			"additionalProperties": {
				"anyOf": [
					{
						"type": "string",
						"description": "Standard string value"
					},
					{
						"type": "number",
						"description": "Standard number value"
					},
					{
						"type": "integer",
						"description": "Standard integer value"
					},
					{
						"type": "boolean",
						"description": "Standard boolean value"
					},
					{
						"type": "null",
						"description": "Null value"
					},
					{
						"type": "object",
						"description": "Nested object value"
					},
					{
						"type": "array",
						"description": "Array value"
					},
					{
						"type": "string",
						"pattern": "^co_z[a-zA-Z0-9]+$",
						"description": "Co-id reference to another CoValue"
					},
					{
						"type": "string",
						"pattern": "^key_[a-zA-Z0-9_]+$",
						"description": "Key reference"
					},
					{
						"type": "string",
						"pattern": "^sealed_",
						"description": "Sealed/encrypted value"
					}
				]
			}
		},
		"costream": {
			"description": "CoStream - CRDT-based append-only stream",
			"type": "array",
			"items": {
				"anyOf": [
					{
						"type": "object",
						"description": "Stream item object"
					},
					{
						"type": "string",
						"description": "Stream item string"
					},
					{
						"type": "number",
						"description": "Stream item number"
					},
					{
						"type": "boolean",
						"description": "Stream item boolean"
					},
					{
						"type": "null",
						"description": "Stream item null"
					}
				]
			}
		},
		"colist": {
			"description": "CoList - CRDT-based collaborative list/array",
			"type": "array",
			"items": {
				"anyOf": [
					{
						"type": "object",
						"description": "List item object"
					},
					{
						"type": "string",
						"description": "List item string (can be co-id reference)"
					},
					{
						"type": "number",
						"description": "List item number"
					},
					{
						"type": "integer",
						"description": "List item integer"
					},
					{
						"type": "boolean",
						"description": "List item boolean"
					},
					{
						"type": "null",
						"description": "List item null"
					},
					{
						"type": "array",
						"description": "Nested array"
					}
				]
			}
		}
	}
}

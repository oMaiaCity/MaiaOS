# fly.toml for Zero Sync Service (sync.hominio.me)
# Single-node zero-cache deployment on Fly.io
# Based on Zero deployment best practices: https://zero.rocicorp.dev/docs/deploy

app = 'hominio-sync'
primary_region = 'fra'

[build]
  # Use official Zero Docker image
  dockerfile = "Dockerfile"

[env]
  PORT = '4848'
  NODE_ENV = 'production'

[http_service]
  internal_port = 4848
  force_https = true
  auto_stop_machines = 'off'  # Changed from 'stop' - keep machines running for better performance
  min_machines_running = 1  # Keep sync service always running

[[http_service.checks]]
  grace_period = "5m"  # Increased to 5 minutes - Zero can take time to initialize, especially on first sync
  interval = "30s"
  method = "GET"
  timeout = "10s"  # Increased timeout for Zero initialization
  path = "/"  # Zero's default health check endpoint (works for single-node deployments)

[[vm]]
  memory = '2gb'  # Increased from 512mb - Zero recommends 2GB+ for better performance
  cpu_kind = 'shared'
  cpus = 2  # Increased from 1 - better performance for sync operations

[[mounts]]
  source = "zero_replica"
  destination = "/data"


{
  "$schema": "composite-factory",
  "parameters": {
    "itemsPath": { "type": "string", "required": true },
    "itemKey": { "type": "string", "default": "id" }
  },
  "factory": {
    "container": {
      "class": "flex p-0 flex-col gap-0 overflow-auto min-h-0 flex-1 w-full"
    },
    "foreach": {
      "items": "{{itemsPath}}",
      "key": "{{itemKey}}",
      "composite": {
        "container": {
          "class": "flex relative gap-2 @xs:gap-3 @sm:gap-4 pb-4 @xs:pb-5 @sm:pb-6 last:pb-0 flex-shrink-0"
        },
        "children": [
          {
            "slot": "timeline-indicator",
            "composite": {
              "container": {
                "class": "flex flex-col items-center shrink-0 w-8 @xs:w-10 @sm:w-12"
              },
              "children": [
                {
                  "slot": "dot",
                  "leaf": {
                    "tag": "div",
                    "classes": "w-3 h-3 @xs:w-4 @xs:h-4 @sm:w-5 @sm:h-5 rounded-full border-2 border-[#001a42] shrink-0 mt-1",
                    "bindings": {
                      "class": {
                        "$if": {
                          "test": { "$eq": [{ "$": "item.status" }, "done"] },
                          "then": "bg-green-500 border-green-500",
                          "else": {
                            "$if": {
                              "test": { "$eq": [{ "$": "item.status" }, "in-progress"] },
                              "then": "bg-blue-500 border-blue-500",
                              "else": "bg-slate-100 border-[#001a42]"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "slot": "line",
                  "leaf": {
                    "tag": "div",
                    "classes": "w-0.5 flex-1 bg-slate-200 min-h-[20px]"
                  }
                }
              ]
            }
          },
          {
            "slot": "timeline-content",
            "composite": {
              "container": {
                "class": "flex flex-1 flex-col gap-1 @xs:gap-1.5 @sm:gap-2"
              },
              "children": [
                {
                  "slot": "header",
                  "leaf": {
                    "tag": "div",
                    "classes": "text-[10px] @xs:text-xs @sm:text-sm text-slate-500 font-medium",
                    "bindings": {
                      "text": { "$formatDate": [{ "$": "item._created" }, "MMM d, yyyy"] }
                    }
                  }
                },
                {
                  "slot": "card",
                  "composite": {
                    "container": {
                      "class": "flex items-start gap-2 @xs:gap-2.5 @sm:gap-3 px-2 py-1.5 @xs:px-2.5 @xs:py-2 @sm:px-3 @sm:py-2.5 @md:px-4 @md:py-3 rounded-lg @sm:rounded-xl @md:rounded-2xl bg-slate-100 border border-white shadow-[0_0_4px_rgba(0,0,0,0.02)] hover:shadow-[0_0_8px_rgba(0,0,0,0.04)] transition-shadow flex-shrink-0 overflow-hidden"
                    },
                    "children": [
                      {
                        "slot": "checkbox",
                        "leaf": {
                          "tag": "button",
                          "attributes": { "type": "button" },
                          "classes": "w-5 h-5 @xs:w-5 @xs:h-5 @sm:w-6 @sm:h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 focus:outline-none focus:ring-1 @sm:focus:ring-2 focus:ring-[#001a42] focus:ring-offset-0.5 @sm:focus:ring-offset-1 cursor-pointer shrink-0 mt-0.5",
                          "bindings": {
                            "class": {
                              "$if": {
                                "test": { "$eq": [{ "$": "item.status" }, "done"] },
                                "then": "border-green-500 bg-green-100",
                                "else": "border-slate-300 bg-slate-100"
                              }
                            }
                          },
                          "events": {
                            "click": {
                              "event": "@core/toggleStatus",
                              "payload": {
                                "id": "item.id",
                                "value1": "todo",
                                "value2": "done",
                                "statusField": "status"
                              }
                            }
                          },
                          "elements": [
                            {
                              "tag": "span",
                              "classes": "text-green-500 font-bold",
                              "bindings": {
                                "text": {
                                  "$if": {
                                    "test": { "$eq": [{ "$": "item.status" }, "done"] },
                                    "then": "✓",
                                    "else": ""
                                  }
                                },
                                "visible": { "$eq": [{ "$": "item.status" }, "done"] }
                              }
                            }
                          ]
                        }
                      },
                      {
                        "slot": "content",
                        "composite": {
                          "container": {
                            "class": "flex flex-1 items-center gap-2 @xs:gap-2.5 @sm:gap-3 min-w-0"
                          },
                          "children": [
                            {
                              "slot": "name",
                              "leaf": {
                                "tag": "input",
                                "attributes": { "type": "text" },
                                "classes": "flex-1 text-xs @xs:text-sm @sm:text-base font-medium text-slate-700 bg-transparent border-none outline-none focus:outline-none focus:ring-0 px-0 min-w-0",
                                "bindings": {
                                  "value": { "$": "item.name" },
                                  "class": {
                                    "$if": {
                                      "test": { "$eq": [{ "$": "item.status" }, "done"] },
                                      "then": "line-through text-slate-400",
                                      "else": ""
                                    }
                                  }
                                },
                                "events": {
                                  "input": {
                                    "event": "@context/updateInput",
                                    "payload": { "field": "name", "value": "@inputValue" }
                                  },
                                  "blur": {
                                    "event": "@core/updateEntity",
                                    "payload": { "id": "item.id", "name": "context.editingName" }
                                  }
                                }
                              }
                            },
                            {
                              "slot": "status",
                              "leaf": {
                                "tag": "span",
                                "classes": "px-1.5 py-0.5 @xs:px-2 @xs:py-0.5 text-[9px] @xs:text-[10px] @sm:text-xs font-medium rounded-full border border-white shrink-0 ml-auto",
                                "bindings": {
                                  "text": { "$": "item.status" },
                                  "class": {
                                    "$if": {
                                      "test": { "$eq": [{ "$": "item.status" }, "done"] },
                                      "then": "bg-green-100 text-green-700",
                                      "else": {
                                        "$if": {
                                          "test": { "$eq": [{ "$": "item.status" }, "in-progress"] },
                                          "then": "bg-blue-100 text-blue-700",
                                          "else": "bg-slate-100 text-slate-700"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      {
                        "slot": "delete",
                        "leaf": {
                          "tag": "button",
                          "classes": "px-1 py-0.5 @xs:px-1.5 @xs:py-1 @sm:px-2 @sm:py-1 text-xs @xs:text-xs @sm:text-sm text-slate-500 hover:text-slate-700 hover:bg-slate-200 rounded-full transition-all duration-200 w-5 h-5 @xs:w-5 @xs:h-5 @sm:w-6 @sm:h-6 flex items-center justify-center shrink-0 mt-0.5",
                          "attributes": { "type": "button" },
                          "elements": ["✕"],
                          "events": {
                            "click": {
                              "event": "@core/deleteEntity",
                              "payload": { "id": "item.id" }
                            }
                          }
                        }
                      }
                    ]
                  }
                }
              ]
            }
          }
        ]
      }
    }
  }
}
